<!doctype html>
<html>
  <body>
    <h3>Owner Admin Panel</h3>
    <button id="login">Login as Owner (Google)</button>
    <div id="info"></div>
    <div id="pending"></div>
    <script>
      const BASE = "<REPLACE_BASE_URL>";
      let token = null;
      document.getElementById('login').onclick = () => {
        const w = window.open(${BASE}/auth/start, "_blank", "width=600,height=700");
        window.addEventListener('message', async (ev) => {
          if (ev.data?.type === 'EGP_AUTH') {
            token = ev.data.token;
            document.getElementById('info').innerText = 'Owner token received';
            loadPending();
          }
        }, { once: true });
      };
      async function loadPending() {
        const r = await fetch(${BASE}/admin/pending, {
          headers: { Authorization: 'Bearer ' + token }
        });
        const j = await r.json();
        if (!j.ok) return alert("error");
        const container = document.getElementById('pending');
        container.innerHTML = "<h4>Pending</h4>";
        (j.pending || []).forEach(p => {
          const div = document.createElement('div');
          div.innerText = p.email + " ";
          const btn = document.createElement('button'); btn.innerText = "Grant";
          btn.onclick = async () => {
            await fetch(${BASE}/admin/grant, { method: 'POST', headers: {'content-type':'application/json', 'Authorization':'Bearer ' + token }, body: JSON.stringify({ email: p.email })});
            loadPending();
          };
          div.appendChild(btn);
          container.appendChild(div);
        });
      }
    </script>
  </body>
</html>